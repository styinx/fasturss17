\documentclass[pdftex,english,oribibl]{llncs}

%%% Spracheinstellungen laden
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[english]{babel}


%%% Schriftart in der Ausgabe/Eingabe
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage[latin1]{inputenc}

%%% Zitate
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[numbers]{natbib}
\bibliographystyle{abbrvnat}
%\bibliographystyle{dinat}
%\bibliographystyle{plainnat}
%\bibliographystyle{splncs}
%% Similar to option "sectionbib" but \refname instead of \bibname
\makeatletter
\renewcommand\bibsection{\section*{\refname\@mkboth{\MakeUppercase{\refname}}{\MakeUppercase{\refname}}}}
\makeatother


%%% Index
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\usepackage{makeidx}
%\makeindex

%% PDF Einstellungen
% muss nach natbib geladen werden!
\usepackage{nameref}
\usepackage{varioref}
\usepackage[pdfusetitle,pdftex,colorlinks]{hyperref}
\hypersetup{pdfborder={0 0 0}}
\hypersetup{bookmarksdepth=3}
\hypersetup{bookmarksopen=true}
\hypersetup{bookmarksopenlevel=1}
\hypersetup{bookmarksnumbered=true}
\usepackage{color}
\hypersetup{colorlinks=false}

%\usepackage[section]{tocbibind}

\makeatletter
\gdef\@keywords{}
\def\keywords#1{\gdef\@keywords{#1}}
\gdef\@subtitle{}
\def\subtitle#1{\gdef\@subtitle{#1}}

%% modified from llncs
\renewenvironment{abstract}{%
  \list{}{\advance\topsep by0.35cm\relax\small%
          \leftmargin=1cm%
          \labelwidth=\z@%
          \listparindent=\z@%
          \itemindent\listparindent%
          \rightmargin\leftmargin}%
          \item[\hskip\labelsep\bfseries\abstractname]}{%
  \if!\@keywords!\else{\item[~]\item[\hskip\labelsep\bfseries\keywordname]\@keywords}\fi%
  \endlist}

\AtBeginDocument{%
  \if!\@subtitle!\else\hypersetup{pdfsubject={\@subtitle}}\fi
  \if!\@keywords!\else\hypersetup{pdfkeywords={\@keywords}}\fi
}
\makeatother

% llncs hyperref fix
\makeatletter
\providecommand*{\toclevel@author}{0}
\providecommand*{\toclevel@title}{0}
\makeatother

%%% Grafiken
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[pdftex]{graphicx}
\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\usepackage{subfigure}

%%% Mathe
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{amsmath}
\usepackage{amssymb}

%%% Listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{listings}
\lstset{escapechar=\%, frame=tb, basicstyle=\footnotesize}

%\definecolor{colorOperator}{rgb}{0.05,0.7,0.05}
%\definecolor{colorComment}{rgb}{0.8,0.5,0}
%\definecolor{colorKeyword}{rgb}{0,0.2,1.0}
%\definecolor{colorConsole}{rgb}{0.5,0,0.8}

\definecolor{colorOperator}{rgb}{0,0,0}
\definecolor{colorComment}{rgb}{0,0,0}
\definecolor{colorKeyword}{rgb}{0,0,0}
\definecolor{colorConsole}{rgb}{0,0,0}
\definecolor{colorString}{rgb}{0,0,0}

\lstdefinestyle{Java}{
	backgroundcolor=\color{white},
	basicstyle=\footnotesize,
	breakatwhitespace=false,
	breaklines=true,
	captionpos=b,
	commentstyle=\color{colorComment},
	deletekeywords={...},
	escapeinside={\%*}{*)},
	extendedchars=true,
	frame=single,
	gobble=4,
	keepspaces=true,
	keywordstyle=\color{colorKeyword},
	language=Java,
	morekeywords={null,...},
	numbers=left,
	numbersep=6pt,
	numberstyle=\tiny\color{white},
	rulecolor=\color{black},
	showspaces=false,
	showstringspaces=false,
	showtabs=false,
	stepnumber=1,
	stringstyle=\color{colorString},
	tabsize=4,
	emph={proc,retp,endp,local}, emphstyle={\color{blue}\textbf},
	literate=
	{=}{{{\color{colorOperator}=}}}1
	{!}{{{\color{colorOperator}!}}}1
	{\&}{{{\color{colorOperator}\&}}}1
	{*}{{{\color{colorOperator}*}}}1
	{.}{{{\color{colorOperator}.}}}1
	{,}{{{\color{colorOperator},}}}1
	{:}{{{\color{colorOperator}:}}}1
	{;}{{{\color{colorOperator};}}}1
	{(}{{{\color{colorOperator}(}}}1
	{)}{{{\color{colorOperator})}}}1
	{<}{{{\color{colorOperator}$<$}}}1
	{>}{{{\color{colorOperator}$>$}}}1
	{[}{{{\color{colorOperator}[}}}1
	{]}{{{\color{colorOperator}]}}}1
	{\{}{{{\color{colorOperator}\{}}}1
	{\}}{{{\color{colorOperator}\}}}}1
}

\lstdefinestyle{Bash}{
	backgroundcolor=\color{white},
	basicstyle=\footnotesize,
	breakatwhitespace=false,
	breaklines=true,
	breakindent=0pt,
	captionpos=b,
	commentstyle=\color{colorComment},
	deletekeywords={...},
	escapeinside={\%*}{*)},
	extendedchars=true,
	frame=single,
	keepspaces=true,
	keywordstyle=\color{colorKeyword},
	language=Bash,
	morekeywords={NULL, nullptr,...},
	rulecolor=\color{black},
	showspaces=false,
	showstringspaces=false,
	showtabs=false,
	stepnumber=1,
	stringstyle=\color{colorString},
	tabsize=4,
	literate=	{\$}{{{\color{colorConsole}\$}}}1
}

%%% Sonstiges
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\TODO}[1]{\par\textcolor{red}{#1}\marginpar{\textcolor{red}{TODO}}}
\newcommand{\TODOX}[1]{\textcolor{red}{#1}\marginpar{\textcolor{red}{TODO}}}
\pagestyle{plain}

% Keine "Schusterjungen"
\clubpenalty = 10000
% Keine "Hurenkinder"
\widowpenalty = 10000 \displaywidowpenalty = 10000


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% BEGIN DOCUMENT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Simulation-based resilience prediction of microservice architectures}
% \subtitle{My (optional) Subtitle}
\author{Samuel Beck, Johannes Günthör, Christoph Zorn}
\institute{University of Stuttgart\\Reliable Software Systems (RSS)\\70569 Stuttgart, Germany}


\begin{document}

\maketitle

\begin{abstract}
	Current software simulators are tailored towards one specific purpose of conservative software simulation. Given the success of these tools it would be useful to run these tools on microservice architectures. This paper will focus on the development of a simulator that can be used for microservice architectures.
\end{abstract}

\section{Introduction}\label{sec:introduction}

	Was rein muss: Was wir wollen (unser ziel), ...
	
	%This is my introduction. %\citet{Shaw2003WritingGoodSoftwareEngineeringResearchPapersMinitutorial} wrote a paper with %hints on how to write good software engineering research papers. By the way, this was an %example for using the \textit{natbib} command \texttt{\textbackslash{}citet\{\}}.
	
	%Section~\ref{sec:anotherSection} presents everything one must know. The conclusions follow %in Section~\ref{sec:conclusions}.

%\section{Another Section}\label{sec:anotherSection}
	
	%\textit{AspectJ} can be used to weave cross-cutting concerns into Java programs %\citep{AspectJ2007}. By the way, this was an example for using the \textit{natbib} command %\texttt{\textbackslash{}citep\{\}}.
	
	%We will now demonstrate how to use subfigures (see Figure~\ref{fig:subfig}). %Figure~\ref{fig:circle} shows a circle. A star is displayed in Figure~\ref{fig:star}.
	
	%\begin{figure}
		% \centering
		%\subfigure[This is a circle.]{\label{fig:circle}
		 % \includegraphics[width=0.3\textwidth]{figures/template_circle.pdf}
		%}
		%\subfigure[This is a star.]{\label{fig:star}
		%  \includegraphics[width=0.3\textwidth]{figures/template_star.pdf}
		%}
		%\caption{A circle (a) and a star (b). Note that any caption ends with a full stop %character.}
		% \label{fig:subfig}
	%\end{figure}
  
\section{Research}\label{sec:research}

\subsection{Tools in Comparison}\label{subsec:toolsInComparison}

\subsubsection{Spigo}
	
	During our research on existing tools for microservice simulation we discovered a tool called spigo. It was written by Adrian Cockcroft a Amazon Web Services employee in the programming language go. Therefore the name spigo comes from Simulate Protocol Interactions in Go. \newline On the first view the tool looked very promising. Spigo contains a fairly simple JSON input and the structure of the parameters is intuitive. Each microservice architecture consists of multiple microservices. Each microservice has a name, a package inheritance a counter of the instances and dependencies to other microservices. The reason we like this tool is because it can simulate the occurrence of an error. Spigo uses the error monkeys from the simian army. But here lies already on of the biggest disadvantages. One can only simulate the failure of a single microservice during the execution. Another point against spigo is the weak documentation of the actual implementation as well as minor bugs that remain from 12 months ago. \newline In conclusion it is quite sure that spigo is not an option for us to use for an extension module. The restrictive and static code design makes it hard to follow the workflow and append another module.

\subsubsection{Palladio}

	Palladio is a software component model for business information systems to enable model-driven predictions on throughput, response time and resource utilization. \cite{Palladio2007} Our motivation to get familiar with Palladio was primarily initiated by Simulizar. A tool extended from Palladio which will be described later in this article. Component models provide many advantages over object-oriented development approaches i.e. higher usability, quality and better test potential. \cite{Palladio2007} This is one of the core strengths of Palladio and therefore a fact that makes it impossible for us to use it for microservices. Microservices are typically fine-grained and divided systems which means that a service knows hardly anything or nothing about the other services. A component based solution would lead our aim into the opposite direction. Every microservice would instantiated as a separate component and as a result the whole architecture would blow up in size.

\subsubsection{Simulizar}
	
	Simulizar is an extension of Palladio. This tool was especially developed for systems that change at runtime i.e. cloudcomputing and virtualized infrastructure environments. Such dynamic system adapt to the environment in order to meet the quality-of-service requirements. In the most cases software systems rely on static and fixed resource management so only steady states can be predicted.\cite{Simulizar2013} Simulizar uses the so called MAPE-K feedback loop (Monitor, Analyze, Plan, Execute, Knowledge) which is used to react to changes that are done during runtime. \newline During our research we came across a presentation on Palladio. One of the developer explained us how the project is built up and what dependent modules are needed to run a simulation. It was also mentioned that other attempts to generate an extension resulted in code duplications of functions that were already implemented but where not detected because of the huge code base. \newline
	Palladio and especially Simulizer seem to be to complex and big to get an understanding of the tool in depth. The sheer amount of code and resources that is used for collecting data and making prediction would be just an overhead on the problems that we currently face.
	

\subsubsection{GreenCloud} 

	With this tool we tried a different approach. Greencloud was designed to calculate the energy consumption of datacenters\citep[P.1]{GreenCloud}. Knowing that this was kind of a long shot we had the idea to take a simulator that simulates distributed objects and map microservice abilities and requirements to these objects. Since the simulator was written to overlook datacenters and their components, a mapping would mean that the entire microservice system would be mapped to a datacenter in the current GreenCloud simulator. Instances of microservices would compare to a server\citep[P.2]{GreenCloud} that gathers metrics. These metrics are currently power consumption, CPU- utilization and workload \citep[P.3]{GreenCloud} and should be changed or replaced to throughput,workload and whatever metrics we require from a microservice. GreenCloud also includes connections\citep[P.3]{GreenCloud} between servers. The connection could possibly used to be a mapping of microservice connections, that we can interfere to implement chaos monkeys. \newline
	Sounding good in theory but taking a closer look at the tool some problems lead to a problems. The focus of GreenCloud is obviously the simulation of power consumption. The previous mentioned connection between servers is not actually modeled but just taken into consideration regarding the power consumption of switches that connect servers together. Additionally there is no sign of the possibility to scale Instances (servers) which is a major part in a microservice system. Lastly workloads are only specified as the computing power they require (e.g. 3 Million Instructions per Second)\citep[P.3]{GreenCloud}. Communication or a differentiation between machines(DB, Workstation, ...) takes additional resources and is currently not taken into account. This would make mapping to a microservice architecture incredibly hard.  
	In hindsight it seems to be not very likely that using GreenCloud would be a good idea. The differences between provided capabilities by GreenCloud and required capabilities by the new tool is just to large. 
	
\subsubsection{CloudSim}

	Developed by the CLOUDS Laboratory of the University of Melbourne, CloudSim is a framework for modeling and simulation of cloud computing infrastructures and services. It allows modeling and simulation of large scale cloud computing data centers aswell as modeling and simulation of application containers and virtualized server hosts.\cite{website_cloudsim} The platform is written in Java and extensible, in fact various extensions for the framework exist. Its architecture consists of multiple layers. The fundamental layer provides management of applications, hosts of virtual machines, etc. while the top layer represents the basic entities for hosts and enables the generation of requests in a variation of approaches, configurations and cloud scenarios.\cite{byrne2017review}


\section{Simulatorspecification}\label{sec:specifictation}
\paragraph{Expected Input properties}
	We want our Simulator to execute the following tasks. In order to simulate a system we need to know how the actual system is build. Therefore we will get information form an input file. This file will contain information about the infrastructure of the system. Each microservice(MS) that is part of the system has the following properties. It has a unique name, the number of instances that are used in the simulation, dependencies on other MS's, throughput and anti-patterns that it implements.\newline
	During runtime we want to be able to modify the system by deleting some instances of microservices. We will achieve this by implementing a chaosmonkey which is inspired by netflix´s toolbox of cloud tools. There can be any number of chaosmonkey´s that need the following parameters to intercept the system. It has a Ms as a target, the number of instances it will delete and the time period in which the error will occur. Finally the input has a number of message objects that travel through the system. We expect the input to look like Figure 1(!!!Instert figzure 1!!!).
	
	\newpage
\begin{figure}
\begin{lstlisting}[style=Java]
	{
		"microservices" : {
			"Frontend": {
				"name" : "frontend",
				"antipatterns" : ["Circuit Breaker"],
				"instances": 4,
				"dependencies": ["Database", "Server"],	
				"throughput" : 3
			},
			"Database": {
				"name" : "database",
				"instances": 2,
				"dependencies": ["Frontend"],
				"throughput" : 3
			},
			"Server": {
				"name" : "server",
				"instances": 1,
				"dependencies": ["Frontend"],
				"throughput" : 3
			}
		},
		"message_object" : {
			"token" : {
				"instances" : 4
				"path" : ["frontend" : 5, "database" : 3]
			}
			"token: {
				"server" : 5
			}
		},
		"failures":	{
			"chaosmonkey" :	{
				"service" : "frontend",
				"instances" : 3,
				"time" : [1, 2, 3]	
			}
		},
		"triggers" : {
		
		}
	}\end{lstlisting}
	\caption{Input structure}
\end{figure}
	
	\newpage
  				
\paragraph{Expected system runtime behavior}
	The basic idea of our system is that is runs on a clock. For each time period every MS will be able to send, receive and work on message objects. If a number of MS instances will go down it is expected to have larger message queues in front of a MS. As a result the system will probably slow down. To guarantee fail-safety the user will have the option to include anti-patterns in the input file. This will make a MS resilient against high workloads and failures of dependent MS. During simulation time we already gather information about performance in each timeframe to generate metrics. We also collect system failures in form of lost message objects if certain MS aren?t available anymore.
 
\paragraph{Expected output metrics}
	We collect the following metrics for all MS´s. The workload, queue utilisation (size) and potential system failures due to missing instances of services. As a result there should be highlighting of eventual problematic data and an analyzation of bottlenecks and performance problems. This information will then be written into a user-friendly output file to deliver a big picture of the system.


\begin{figure}
		\includegraphics[width=1\textwidth]{figures/MicroserviceSimulatorPicture.png}
		\caption{Simulator System Visualization}
\end{figure}



--------------------------------------\newline
was muss das tool können?\newline
was ist der input \newline
was ist der output \newline
grafik wie system ablaufen soll\newline
welche metriken müssen gesammelt werden \newline

 
\paragraph{Execution}
Validate input\newline
Failure\newline
 
Types of failures:\newline
Failure of one service\newline
Failure of multiple services\newline
 
Failure modes:\newline
Static \newline
Dynamic \newline
Event driven/Triggered \newline
 
Types of reliability patterns: \newline
Circuit breaker \newline
Client-side load balancing \newline
 
\paragraph{Metrics} 
How does the failure propagate \newline
Did the fail-safe measures (circuit breaker, etc.) work \newline
Systemrun was successful \newline
 
 
 
TODO - RESEARCH:
Occurring failure types 
Reliability patterns
Metrics
Input structure and file format
 
Available simulators for cloud systems:
Spigo
Palladio/Simulizar
cloudsim




\section{Simulatordocumentation}\label{sec:documentation}
\begin{itemize}
\item struktur des programms
\item probleme in der implementierung 
\item 

\end{itemize}

\section{Conclusions}\label{sec:conclusions}

  These are my conclusions.

\bibliography{template}

\end{document}
